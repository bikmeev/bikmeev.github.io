<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="cameraStyle.css">
    <title>Camera Capture</title>
</head>
<body>
    <div class="container">
        <p class="blue-box">–ó–∞–≥—Ä—É–∑–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é —Å–æ —Å–≤–æ–∏–º –≤–æ–ø—Ä–æ—Å–æ–º</p>
        <div class="switch">
            <button class="text-switch" onclick="openText()">
                <p class="text-icon">ùêì</p>
                <p>–ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ–∫—Å—Ç</p>
            </button>
            <button class="camera-switch" onclick="location.href='camera.html'">
                <img src="camera.svg">
                <p>–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ</p>
            </button>
        </div>
        <label for="file" class="custom-file-upload">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</label>
        <input type="file" id="file">
        <div>
            <button class="purple-button" id="submit">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</button>
        </div>
    </div>
    <script>

        function openText(){
            localStorage.setItem('question', 'true')
            window.location.href='index.html';
        }

        const fileTypes = [
            "image/apng",
            "image/bmp",
            "image/gif",
            "image/jpeg",
            "image/pjpeg",
            "image/png",
            "image/svg+xml",
            "image/tiff",
            "image/webp",
            "image/x-icon",
        ];

        function returnFileSize(number) {
            if (number < 1024) {
                return `${number} bytes`;
            } else if (number >= 1024 && number < 1048576) {
                return `${(number / 1024).toFixed(1)} KB`;
            } else if (number >= 1048576) {
                return `${(number / 1048576).toFixed(1)} MB`;
            }
        }

        function validFileType(file) {
            return fileTypes.includes(file.type);
        }
        
        function openText(){
            localStorage.setItem('question', 'true');
            window.location.href='index.html';
        }
        
        submit.addEventListener('click', () => {
            const para = document.createElement("p");
            if (file.length === 0) {
                para.textContent = "–§–∞–π–ª –Ω–µ –±—ã–ª –≤—ã–±—Ä–∞–Ω.";
            } else{
                if (validFileType(file)) {
                    input.style.opacity = 0;
                    const input = document.querySelector("input");
                    const file = input.files;
                    const imageUrl = URL.createObjectURL(file);
                    console.log(`Image URL: ${imageUrl}`);
                    fetch(imageUrl)
                    .then(res => res.blob())
                    .then(blob => {
                        const formData = new FormData();
                        formData.append('file', blob, 'image.png');
                        return fetch('https://intelektusrv.ru:8000/recognize-text', {
                            method: 'POST',
                            body: formData,
                        });
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log(`Received data:`, data);
                        localStorage.setItem('question2', 'true');
                        if(data.text === '\f' || data.text === ' \n\f'){
                            localStorage.setItem('question2_data', "null");
                        }
                        else{
                            localStorage.setItem('question2_data', data.text);
                            localStorage.setItem('question2_data_link', imageUrl);
                        }
                        window.location.href = 'index.html';
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            } else {
                    para.textContent = ` –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª ${file.name}: –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç. –û–±–Ω–æ–≤–∏—Ç–µ —Å–≤–æ–π –≤—ã–±–æ—Ä.`;
                }

            }
        });

    </script>
</body>
</html>
